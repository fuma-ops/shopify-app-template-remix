{% comment %} 
  ⚠️ SAFETY SHIELD: This line ensures the bar ONLY appears on Product Pages. 
{% endcomment %}
{% if request.page_type == 'product' and product %}

<div class="sticky-card-container">
  <div class="sticky-content">
    
    <!-- Left Side: Product Info -->
    <div class="sticky-product-info">
      {% if product.featured_image %}
        <img src="{{ product.featured_image | image_url: width: 100 }}" alt="{{ product.title }}" class="sticky-image">
      {% endif %}
      <div class="sticky-text-group">
        <span class="sticky-title">{{ product.title }}</span>
        <span class="sticky-price">{{ product.price | money }}</span>
      </div>
    </div>
    
    <!-- Right Side: The Add to Cart Form -->
    <form action="/cart/add" method="post" enctype="multipart/form-data" class="sticky-actions">
      <!-- 1. Get the correct Variant ID -->
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
      
      <!-- 2. Redirect to Cart after click -->
      <input type="hidden" name="return_to" value="/cart">

      <button type="submit" class="sticky-btn">
        {{ block.settings.button_text }}
      </button>
    </form>

  </div>
</div>

<style>
  .sticky-card-container {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    z-index: 9999;
    padding: 12px 24px;
    background-color: {{ block.settings.background_color }};
    box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
    border-top: 1px solid rgba(0,0,0,0.1);
    
    /* Optional: Your Gradients */
    {% if block.settings.bg_theme == 'christmas' %}
      background: repeating-linear-gradient(45deg, #cc0000, #cc0000 10px, #006400 10px, #006400 20px);
    {% elsif block.settings.bg_theme == 'ocean' %}
      background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
    {% endif %}
  }

  .sticky-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
  }

  .sticky-product-info { display: flex; align-items: center; gap: 15px; }
  
  .sticky-image {
    width: 50px; height: 50px; object-fit: cover;
    border-radius: 6px; border: 2px solid #fff;
  }

  .sticky-text-group { display: flex; flex-direction: column; line-height: 1.2; }
  
  .sticky-title { font-weight: bold; font-size: 14px; color: {{ block.settings.text_color }}; }
  .sticky-price { font-size: 14px; opacity: 0.9; color: {{ block.settings.text_color }}; }

  .sticky-btn {
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    padding: 12px 24px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
  }
  .sticky-btn:hover { opacity: 0.9; transform: translateY(-1px); }
</style>

<script>
  (function() {
    // Analytics Tracking
    const API_URL = "https://shopify-app-template-remix-xm46.onrender.com/api/track";
    const SHOP_DOMAIN = "{{ shop.permanent_domain }}";

    function track(event) {
      fetch(API_URL, {
        method: "POST",
        body: new URLSearchParams({ shop: SHOP_DOMAIN, event: event })
      }).catch(e => console.log(e));
    }
    
    window.addEventListener("load", () => track("view"));
    const btn = document.querySelector(".sticky-btn");
    if(btn) btn.addEventListener("click", () => track("click"));
  })();
</script>

{% schema %}
{
  "name": "Sticky Add To Cart",
  "target": "body",
  "settings": [
    { "type": "text", "id": "button_text", "label": "Button Label", "default": "Add to Cart" },
    { "type": "select", "id": "bg_theme", "label": "Theme", "options": [
        { "value": "none", "label": "Solid Color" },
        { "value": "christmas", "label": "Christmas" },
        { "value": "ocean", "label": "Ocean" }
      ], "default": "none" },
    { "type": "color", "id": "background_color", "label": "Background Color", "default": "#ffffff" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#000000" },
    { "type": "color", "id": "button_color", "label": "Button Color", "default": "#000000" },
    { "type": "color", "id": "button_text_color", "label": "Button Text Color", "default": "#ffffff" }
  ]
}
{% endschema %}

{% endif %} 
{% comment %} ⚠️ END SHIELD {% endcomment %}